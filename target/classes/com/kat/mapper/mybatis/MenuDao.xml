<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kat.seat.dao.MenuDao">
	<!-- 좌석 정보 등록 -->
	<insert id="insertMenu" parameterType="com.kat.seat.model.MenuInfo">
		INSERT INTO PRODUCT
		values (#{product_name}, #{cost}, #{catagory}, #{business_number}, #{business_no}, #{menu_photo_file}, #{create_date}, #{continent}, #{country}, #{city})
	</insert>

	<!-- 등록된 메뉴 수 -->
	<select id="menuSelectCount" resultType="int">
		SELECT COUNT(*) FROM PRODUCT where user_id = #{user_id}
	</select>

	<!--메뉴 리스트 담기 -->
	<select id="menuList" resultType="com.kat.seat.model.MenuInfo">
		SELECT product_no, product_name, cost, catagory, business_number, user_id, menu_photo_file, create_date, continent, country, city
		FROM PRODUCT WHERE user_id = #{param1}
		ORDER BY create_date DESC 
		LIMIT #{param2}, #{param3}
	</select>
		
	<!-- 메뉴 수정할 데이터 가져오기 -->
	<select id="getMenuinfo" resultType="com.kat.seat.model.MenuInfo">
		SELECT product_no, product_name, cost, catagory, business_number, user_id, menu_photo_file, create_date, continent, country, city
		FROM PRODUCT 
		where product_no = #{product_no}
	</select>
	
	<!-- 수정하기 -->
	<insert id="menuUpdate" parameterType="com.kat.seat.model.MenuInfo">
		UPDATE PRODUCT
		SET product_name = #{product_name}, cost = #{cost}, catagory = #{catagory} , menu_photo_file = #{menu_photo_file}
		where product_no = #{product_no}
	</insert>
	
	<!-- 삭제하기 -->
	<select id="menudelete">
		DELETE FROM PRODUCT WHERE product_no = #{product_no}
	</select>
	
	<!-- 매장 사진 등록 -->
	<insert id="insertshop" parameterType="com.kat.seat.model.ShopPhoto">
		insert into shop_photo (user_id, file_shopphoto, create_date)
		values (#{user_id}, #{file_shopphoto}, now())
	</insert>
	
	<!-- 등록된 매장 사진수 -->
	<select id="shopCount" resultType="int">
		SELECT COUNT(*) FROM SHOP_PHOTO WHERE USER_ID = #{user_id}
	</select>

	<!--사진 리스트 담기 -->
	<select id="shopPhotoList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
		WHERE USER_ID = #{param1}
		LIMIT #{param2}, #{param3}
	</select>
	
	<!--매장사진 삭제하기 -->
	<select id="shopPhotodelete">
		delete FROM SHOP_PHOTO where photo_no = #{product_no}
	</select>
	
	<!--사진 리스트 담기 -->
	<select id="shopSearchList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO where user_id = #{param1} limit #{param2}, #{param3}
	</select>
	
	<!-- member_id 담기 -->
<!-- 	<select id="member_no" resultType="int">
		select member_no from member where user_id = #{param1}
	</select> -->
	
	<!-- 키워드로 검색 수 -->
	<select id="shopCountList" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where menu_name like CONCAT('%',#{keyword},'%')
	</select>
	<!-- 키워드로 검색 리스트 담기 -->
	<select id="shopSearch" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, business.business_name, business.address1, product.menu_catagory , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner joinbusiness on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where menu_name like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	
	<!-- 메뉴종류로 검색 수 -->
	<select id="shopCountList2" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where menu_catagory like CONCAT('%',#{keyword},'%')
	</select>	
	<!-- 메뉴종류로 검색 리스트 담기 -->
	<select id="shopSearch2" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), business.business_name, business.address1, product.menu_catagory, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where menu_catagory like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	
	<!-- 지역으로 검색 수 -->
	<select id="shopCountList3" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{keyword},'%')
	</select>	
	<!-- 지역으로 검색 리스트 담기 -->
	<select id="shopSearch3" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), product.menu_name, business.address1 , product.user_id , product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	
	<!-- 지역 /키워드로 검색 수 -->
	<select id="shopCountList4" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 지역 /키워드로 검색 리스트 담기 -->
	<select id="shopSearch4" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_catagory , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 메뉴종류 /키워드로 검색 수 -->
	<select id="shopCountList5" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where menu_catagory like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 메뉴종류 /키워드로 검색 리스트 담기 -->
	<select id="shopSearch5" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_catagory , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where menu_catagory like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 지역 / 메뉴종류 검색 수 -->
	<select id="shopCountList6" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_catagory like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 지역 / 메뉴종류 리스트 담기 -->
	<select id="shopSearch6" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), product.menu_name, business.address1, product.menu_catagory, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_catagory like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 지역 / 메뉴종류  / 키워드 검색 수 -->
	<select id="shopCountList7" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_catagory like CONCAT('%',#{param2},'%') and menu_name like CONCAT('%',#{param3},'%')
	</select>	
	
	<!-- 지역 / 메뉴종류  / 키워드 검색 리스트 담기 -->
	<select id="shopSearch7" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_catagory , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_catagory like CONCAT('%',#{param2},'%') and menu_name like CONCAT('%',#{param3},'%') limit #{param4}, #{param5}
	</select>
	
	<!-- 매장 정보 가져오기 -->
	<select id="getShopAddress" resultType="com.kat.seat.model.InfoShopAddress">
	select m.member_no , m.user_id, b.address1, b.business_name from member m , business b 
	where m.member_no = b.company_no and m.user_id = #{param1}
	</select>
	
	
	<!-- 사업자인지 확인하기 -->
	<select id="getCategory" resultType="String">
		select category from member where user_id= #{param1};
	</select>
	
	<select id="shopCount2" resultType="int">
		SELECT COUNT(*) FROM SHOP_PHOTO
	</select>
	
	<select id="getShopAddress2" resultType="com.kat.seat.model.InfoShopAddress">
		SELECT M.MEMBER_NO, USER_ID, ADDRESS1, COMPANY
		FROM MEMBER M LEFT JOIN BUSINESS B
		ON M.MEMBER_NO = B.MEMBER_NO AND M.USER_ID = #{user_id}
	</select>
	
	<select id="shopPhotoList2" resultType="com.kat.seat.model.ShopPhoto">
		<!-- SELECT * FROM SHOP_PHOTOwhere user_id = #{param1} limit #{param2}, #{param3} -->
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
	</select>
	
	<select id="menuSelectCount2" resultType="int">
		SELECT COUNT(*) FROM PRODUCT 
	</select>
	
	<select id="menuList2" resultType="com.kat.seat.model.MenuInfo">
		SELECT * FROM PRODUCT;
	</select>
</mapper>


