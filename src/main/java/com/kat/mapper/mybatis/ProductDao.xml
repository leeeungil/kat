<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kat.product.dao.ProductDao">
	<!-- 상품 데이터 등록 START-->
	<select id="findBusinessNumber" resultType="String">
		SELECT BUSINESS_NUMBER FROM BUSINESS WHERE USER_ID=#{user_id}
	</select>
	<insert id="insertProduct" parameterType="com.kat.product.model.ProductInfo">
		INSERT INTO PRODUCT
		VALUES (0, #{product_title}, #{product_type}, now(), #{cost}, #{continent}, #{country}, #{city}, #{user_id}, #{business_number}, #{product_main_photo}, #{sell_start}, #{sell_end}, 0)
	</insert>
	<select id="findProductNo" resultType="int">
		SELECT PRODUCT_NO FROM PRODUCT WHERE BUSINESS_NUMBER=#{business_number} AND PRODUCT_TITLE=#{product_title} AND USER_ID=#{user_id}
	</select>
  	<insert id="insertProductContent" parameterType="com.kat.product.model.ProductInfo">
		INSERT INTO PRODUCT_CONTENT
		VALUES (0, #{product_no}, #{user_profile}, #{product_content} ,#{product_info}, 0)
	</insert>
	<select id="findProductContentNo" resultType="int">
		SELECT PRODUCT_CONTENT_NO FROM PRODUCT_CONTENT WHERE PRODUCT_NO=#{product_no} AND DELETE_FLAG=0
	</select>
	<insert id="insertProductPhoto" parameterType="com.kat.product.model.ProductInfo">
		INSERT INTO PRODUCT_PHOTO
		VALUES (0, #{product_photo1}, #{product_photo2} ,#{product_photo3}, #{product_photo4}, #{product_photo5}, #{product_photo6}, 
			#{product_photo7}, #{product_photo8}, #{product_photo9}, #{product_photo10}, #{product_content_no}, 0)
	</insert>
	<insert id="insertProductCourse" parameterType="com.kat.product.model.ProductInfo">
		INSERT INTO PRODUCT_COURSE
		VALUES (#{product_no}, 0, #{course} ,#{course_photo_dir}, 0)
	</insert>
	<!-- 상품 데이터 등록 END-->

	
	<!-- 여행 상품 전체 가져오기 START -->
	
	<!-- 전체 가져오기(여행상품 메뉴 선택시) -->
	<select id="findAllTravelProduct" resultType="com.kat.product.model.ProductInfo">
		SELECT PRODUCT_NO, PRODUCT_TITLE, PRODUCT_TYPE, CREATE_DATE, COST, CONTINENT, COUNTRY, CITY, USER_ID, BUSINESS_NUMBER, PRODUCT_MAIN_PHOTO, SELL_START, SELL_END
		FROM PRODUCT WHERE DELETE_FLAG=0
	</select>
	<!-- product_type 별로 가져오기 -->
	<select id="findTypeTravelProduct" resultType="com.kat.product.model.ProductInfo">
		SELECT PRODUCT_NO, PRODUCT_TITLE, PRODUCT_TYPE, CREATE_DATE, COST, CONTINENT, COUNTRY, CITY, USER_ID, BUSINESS_NUMBER, PRODUCT_MAIN_PHOTO, SELL_START, SELL_END
		FROM PRODUCT WHERE PRODUCT_TYPE=#{product_type} AND DELETE_FLAG=0
	</select>
	<!-- search_word 검색 후 가져오기 (메인 제목, 대륙, 도시, 국가) -->
	<select id="findWordTravelProduct" resultType="com.kat.product.model.ProductInfo">
		SELECT PRODUCT_NO, PRODUCT_TITLE, PRODUCT_TYPE, CREATE_DATE, COST, CONTINENT, COUNTRY, CITY, USER_ID, BUSINESS_NUMBER, PRODUCT_MAIN_PHOTO, SELL_START, SELL_END
		FROM PRODUCT WHERE (PRODUCT_TITLE LIKE #{search_word} OR CONTINENT LIKE #{search_word} OR COUNTRY LIKE #{search_word} OR CITY LIKE #{search_word} ) AND DELETE_FLAG=0
	</select>
	<!-- 여행 상품 상세 정보 가져오기 -->
	<select id="findProductDetailInfo" resultType="com.kat.product.model.ProductInfo">
		SELECT *
		FROM PRODUCT_PHOTO PPHO,
			(SELECT P.PRODUCT_NO, PRODUCT_TITLE, PRODUCT_TYPE, CREATE_DATE, COST, CONTINENT, COUNTRY, CITY, USER_ID, BUSINESS_NUMBER, PRODUCT_MAIN_PHOTO, SELL_START, SELL_END,
						PRODUCT_CONTENT_NO, USER_PROFILE, PRODUCT_CONTENT, PRODUCT_INFO, COURSE_NO, COURSE, COURSE_PHOTO_DIR
			FROM PRODUCT P, PRODUCT_CONTENT PCON, PRODUCT_COURSE PCOUR 
			WHERE P.PRODUCT_NO=PCON.PRODUCT_NO AND PCON.PRODUCT_NO=PCOUR.PRODUCT_NO AND PCOUR.DELETE_FLAG=0 AND P.PRODUCT_NO=#{product_no} ) PTOTAL
		WHERE PPHO.PRODUCT_CONTENT_NO=PTOTAL.PRODUCT_CONTENT_NO;
	</select>
	
	
	<!-- 여행 상품 전체 가져오기 END -->
	
	<!-- 원하는 상품 즐겨찾기 하기 START -->
	<insert id="addfavoriteProduct" parameterType="com.kat.product.model.FavoriteProduct">
		INSERT INTO FAVORITE_PRODUCT
		VALUES (0, #{product_no}, (SELECT MEMBER_NO FROM MEMBER WHERE USER_ID=#{user_id}), now(), 0)
	</insert>
	<select id="delfavoriteProduct" parameterType="com.kat.product.model.FavoriteProduct">
		UPDATE FAVORITE_PRODUCT SET DELETE_FLAG = 1 where product_no = #{product_no} 
		AND member_no = (SELECT MEMBER_NO FROM MEMBER WHERE USER_ID=#{user_id})
	</select>
	<select id="chkFavoriteProduct" resultType="String">
		SELECT PRODUCT_NO FROM FAVORITE_PRODUCT
		WHERE DELETE_FLAG=0 
		AND MEMBER_NO=(SELECT MEMBER_NO FROM MEMBER WHERE USER_ID=#{user_id})
	</select>
	<!-- 원하는 상품 즐겨찾기 하기 END -->
	
	
	
	
	
	
	<!-- 등록된 PRODUCT 갯수 -->
	<select id="menuSelectCount" resultType="int">
		SELECT COUNT(*) 
		FROM PRODUCT 
		WHERE USER_ID = #{param1} AND DELETE_FLAG=0
	</select>

	<!--PRODUCT 리스트 담기 -->
	<!-- <select id="menuList" resultType="com.kat.seat.model.MenuInfo">
		SELECT PRODUCT_NO, PRODUCT_NAME, PH.PRODUCT_TYPE, COST, BUSINESS_NUMBER, USER_ID, CONTINENT, COUNTRY, CITY, PH.CREATE_DATE, 0, BOARD_NO
		FROM PRODUCT PR LEFT JOIN PHOTO PH
		ON PR.PRODUCT_TYPE = PH.PRODUCT_TYPE WHERE PR.PRODUCT_NO = "1"
	</select> -->
	<select id="menuList" resultType="com.kat.seat.model.MenuInfo">
		SELECT PR.PRODUCT_NO, PRODUCT_NAME, PR.PRODUCT_TYPE, COST, BUSINESS_NUMBER, USER_ID, CONTINENT, COUNTRY, CITY, 
				PR.CREATE_DATE, BOARD_NO, FILE_DIR AS file_menu_photo
		FROM PRODUCT PR LEFT JOIN PHOTO PH
		ON PR.USER_ID=PH.APPLY_USER_ID AND PR.PRODUCT_NO=PH.BOARD_NO
		WHERE USER_ID=#{param1} AND DELETE_FLAG=0
	    ORDER BY PR.CREATE_DATE DESC LIMIT #{param2}, #{param3}
	</select>
			
	<!-- 메뉴 수정할 데이터 가져오기 -->
	<select id="getMenuinfo" resultType="com.kat.seat.model.MenuInfo">
		SELECT product_no, product_name, cost, product_type, business_number, user_id, file_menu_photo, create_date, continent, country, city
		FROM PRODUCT 
		where product_no = #{product_no}
	</select>
	
	<!-- 수정하기 -->
	<insert id="menuUpdate" parameterType="com.kat.seat.model.MenuInfo">
		UPDATE PRODUCT
		SET product_name = #{product_name}, cost = #{cost}, category = #{category} , file_menu_photo = #{file_menu_photo}
		where product_no = #{product_no}
	</insert>
	
	<!-- 삭제하기 -->
	<select id="menudelete">
		DELETE FROM PRODUCT WHERE product_no = #{product_no}
	</select>
	
	<!-- 매장 사진 등록 -->
	<insert id="insertshop" parameterType="com.kat.seat.model.ShopPhoto">
		insert into shop_photo (user_id, file_shopphoto, create_date)
		values (#{user_id}, #{file_shopphoto}, now())
	</insert>
	
	<!-- 등록된 매장 사진수 -->
	<select id="shopCount" resultType="int">
		SELECT COUNT(*) FROM SHOP_PHOTO WHERE USER_ID = #{user_id}
	</select>

	<!--사진 리스트 담기 -->
	<select id="shopPhotoList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
		WHERE USER_ID = #{param1}
		LIMIT #{param2}, #{param3}
	</select>
	
	<!--매장사진 삭제하기 -->
	<select id="shopPhotodelete">
		delete FROM SHOP_PHOTO where photo_no = #{product_no}
	</select>
	
	<!--사진 리스트 담기 -->
	<select id="shopSearchList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO where user_id = #{param1} limit #{param2}, #{param3}
	</select>
	
	<!-- 매장 정보 가져오기 -->
	<select id="getShopAddress" resultType="com.kat.seat.model.InfoShopAddress">
	select m.member_no , m.user_id, b.address1, b.business_name from member m , business b 
	where m.member_no = b.company_no and m.user_id = #{param1}
	</select>
	
	<!-- 사업자인지 확인하기 -->
	<select id="getCategory" resultType="String">
		select category from member where user_id= #{param1};
	</select>
	
	<!-- <select id="shopCount2" resultType="int">
		SELECT COUNT(*) 
		FROM PHOTO PH, PRODUCT PR 
		WHERE PH.PRODUCT_TYPE=PR.PRODUCT_TYPE AND PR.PRODUCT_TYPE = 1
	</select>
	
	<select id="getShopAddress2" resultType="com.kat.seat.model.InfoShopAddress">
		SELECT M.MEMBER_NO, USER_ID, ADDRESS1, COMPANY
		FROM MEMBER M LEFT JOIN BUSINESS B
		ON M.MEMBER_NO = B.MEMBER_NO AND M.USER_ID = #{user_id}
	</select>
	
	<select id="shopPhotoList2" resultType="com.kat.seat.model.ShopPhoto">
		SELECT * FROM SHOP_PHOTOwhere user_id = #{param1} limit #{param2}, #{param3}
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
	</select>
	
	<select id="menuSelectCount2" resultType="int">
		SELECT COUNT(*) FROM PRODUCT 
	</select>
	
	<select id="menuList2" resultType="com.kat.seat.model.MenuInfo">
		SELECT * FROM PRODUCT;
	</select> -->
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 장준영 수정 중 : 메인에서 상품 검색하기 -->
	<!-- continent, country 해당 상품 리스트 -->
	<select id="productSearch_1" resultType="com.kat.seat.model.InfoShopSearch">
		select member.company_no, business.business_name, business.address1, product.menu_category , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
		from member inner joinbusiness on member.company_no = business.company_no inner join product on business.company_no = product.company_no
		where menu_name like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
</mapper>

