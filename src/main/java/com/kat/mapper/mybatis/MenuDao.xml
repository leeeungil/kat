<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kat.seat.dao.MenuDao">
	<!-- 상품 데이터 등록 -->
	<insert id="insertProduct" parameterType="com.kat.seat.model.MenuInfo">
		INSERT INTO PRODUCT
		VALUES (0, #{product_name}, #{product_type}, #{cost}, #{business_number}, #{user_id}, #{continent}, #{country}, #{city}, now(), 0)
	</insert>
	<select id="getProductNo" resultType="int">
		SELECT PRODUCT_NO FROM PRODUCT WHERE BUSINESS_NUMBER=#{business_number} AND PRODUCT_NAME=#{product_name} AND USER_ID=#{user_id} AND DELETE_FLAG=0
	</select>
	<!-- 상품 이미지 등록 -->
	<insert id="insertImage" parameterType="com.kat.seat.model.MenuInfo">
		INSERT INTO PHOTO
		VALUES (0, #{product_type}, #{product_no} ,#{file_menu_photo}, #{user_id}, now())
	</insert>

	<!-- 등록된 PRODUCT 갯수 -->
	<select id="menuSelectCount" resultType="int">
		SELECT COUNT(*) 
		FROM PRODUCT 
		WHERE USER_ID = #{param1}
	</select>

	<!--PRODUCT 리스트 담기 -->
	<!-- <select id="menuList" resultType="com.kat.seat.model.MenuInfo">
		SELECT PRODUCT_NO, PRODUCT_NAME, PH.PRODUCT_TYPE, COST, BUSINESS_NUMBER, USER_ID, CONTINENT, COUNTRY, CITY, PH.CREATE_DATE, 0, BOARD_NO
		FROM PRODUCT PR LEFT JOIN PHOTO PH
		ON PR.PRODUCT_TYPE = PH.PRODUCT_TYPE WHERE PR.PRODUCT_NO = "1"
	</select> -->
	<select id="menuList" resultType="com.kat.seat.model.MenuInfo">
		SELECT * 
		FROM PRODUCT PR LEFT JOIN PHOTO PH
		ON PR.USER_ID=PH.APPLY_USER_ID AND PR.PRODUCT_NO=PH.BOARD_NO
		WHERE USER_ID=#{param1} AND DELETE_FLAG=0
	    ORDER BY PR.CREATE_DATE DESC LIMIT #{param2}, #{param3}
	</select>
			
	<!-- 메뉴 수정할 데이터 가져오기 -->
	<select id="getMenuinfo" resultType="com.kat.seat.model.MenuInfo">
		SELECT product_no, product_name, cost, product_type, business_number, user_id, file_menu_photo, create_date, continent, country, city
		FROM PRODUCT 
		where product_no = #{product_no}
	</select>
	
	<!-- 수정하기 -->
	<insert id="menuUpdate" parameterType="com.kat.seat.model.MenuInfo">
		UPDATE PRODUCT
		SET product_name = #{product_name}, cost = #{cost}, category = #{category} , file_menu_photo = #{file_menu_photo}
		where product_no = #{product_no}
	</insert>
	
	<!-- 삭제하기 -->
	<select id="menudelete">
		DELETE FROM PRODUCT WHERE product_no = #{product_no}
	</select>
	
	<!-- 매장 사진 등록 -->
	<insert id="insertshop" parameterType="com.kat.seat.model.ShopPhoto">
		insert into shop_photo (user_id, file_shopphoto, create_date)
		values (#{user_id}, #{file_shopphoto}, now())
	</insert>
	
	<!-- 등록된 매장 사진수 -->
	<select id="shopCount" resultType="int">
		SELECT COUNT(*) FROM SHOP_PHOTO WHERE USER_ID = #{user_id}
	</select>

	<!--사진 리스트 담기 -->
	<select id="shopPhotoList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
		WHERE USER_ID = #{param1}
		LIMIT #{param2}, #{param3}
	</select>
	
	<!--매장사진 삭제하기 -->
	<select id="shopPhotodelete">
		delete FROM SHOP_PHOTO where photo_no = #{product_no}
	</select>
	
	<!--사진 리스트 담기 -->
	<select id="shopSearchList" resultType="com.kat.seat.model.ShopPhoto">
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO where user_id = #{param1} limit #{param2}, #{param3}
	</select>
	
	<!-- 매장 정보 가져오기 -->
	<select id="getShopAddress" resultType="com.kat.seat.model.InfoShopAddress">
	select m.member_no , m.user_id, b.address1, b.business_name from member m , business b 
	where m.member_no = b.company_no and m.user_id = #{param1}
	</select>
	
	<!-- 사업자인지 확인하기 -->
	<select id="getCategory" resultType="String">
		select category from member where user_id= #{param1};
	</select>
	
	<!-- <select id="shopCount2" resultType="int">
		SELECT COUNT(*) 
		FROM PHOTO PH, PRODUCT PR 
		WHERE PH.PRODUCT_TYPE=PR.PRODUCT_TYPE AND PR.PRODUCT_TYPE = 1
	</select>
	
	<select id="getShopAddress2" resultType="com.kat.seat.model.InfoShopAddress">
		SELECT M.MEMBER_NO, USER_ID, ADDRESS1, COMPANY
		FROM MEMBER M LEFT JOIN BUSINESS B
		ON M.MEMBER_NO = B.MEMBER_NO AND M.USER_ID = #{user_id}
	</select>
	
	<select id="shopPhotoList2" resultType="com.kat.seat.model.ShopPhoto">
		SELECT * FROM SHOP_PHOTOwhere user_id = #{param1} limit #{param2}, #{param3}
		SELECT PHOTO_NO, USER_ID, FILE_SHOPPHOTO, CREATE_DATE
		FROM SHOP_PHOTO
	</select>
	
	<select id="menuSelectCount2" resultType="int">
		SELECT COUNT(*) FROM PRODUCT 
	</select>
	
	<select id="menuList2" resultType="com.kat.seat.model.MenuInfo">
		SELECT * FROM PRODUCT;
	</select> -->
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 장준영 수정 중 : 메인에서 상품 검색하기 -->
	<!-- continent, country 해당 상품 수 -->
	<select id="productCount_12" resultType="int">
		SELECT COUNT(*)
		FROM PRODUCT WHERE CONTINENT=#{param1} AND COUNTRY=#{param2} AND DELETE_FLAG=0
	</select>
	<!-- continent, country 해당 상품 리스트 -->
	<select id="productSearch_12" resultType="com.kat.seat.model.InfoShopSearch">
		select member.company_no, business.business_name, business.address1, product.menu_category , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
		from member inner joinbusiness on member.company_no = business.company_no inner join product on business.company_no = product.company_no
		where menu_name like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	<!-- 메뉴종류로 검색 수 -->
	<select id="shopCountList2" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where menu_category like CONCAT('%',#{keyword},'%')
	</select>	
	<!-- 메뉴종류로 검색 리스트 담기 -->
	<select id="shopSearch2" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), business.business_name, business.address1, product.menu_category, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where menu_category like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	
	<!-- 지역으로 검색 수 -->
	<select id="shopCountList3" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{keyword},'%')
	</select>	
	<!-- 지역으로 검색 리스트 담기 -->
	<select id="shopSearch3" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), product.menu_name, business.address1 , product.user_id , product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') limit #{param2}, #{param3}
	</select>
	
	
	<!-- 지역 /키워드로 검색 수 -->
	<select id="shopCountList4" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 지역 /키워드로 검색 리스트 담기 -->
	<select id="shopSearch4" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_category , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 메뉴종류 /키워드로 검색 수 -->
	<select id="shopCountList5" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where menu_category like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 메뉴종류 /키워드로 검색 리스트 담기 -->
	<select id="shopSearch5" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_category , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where menu_category like CONCAT('%',#{param1},'%') and menu_name like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 지역 / 메뉴종류 검색 수 -->
	<select id="shopCountList6" resultType="int">
	select count(distinct(member.company_no))
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_category like CONCAT('%',#{param2},'%')
	</select>	
	<!-- 지역 / 메뉴종류 리스트 담기 -->
	<select id="shopSearch6" resultType="com.kat.seat.model.InfoShopSearch">
	select distinct(member.company_no), product.menu_name, business.address1, product.menu_category, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_category like CONCAT('%',#{param2},'%') limit #{param3}, #{param4}
	</select>
	
	
	<!-- 지역 / 메뉴종류  / 키워드 검색 수 -->
	<select id="shopCountList7" resultType="int">
	SELECT COUNT(*) 
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no 
	where address1 like CONCAT('%',#{param1},'%') and menu_category like CONCAT('%',#{param2},'%') and menu_name like CONCAT('%',#{param3},'%')
	</select>	
	
	<!-- 지역 / 메뉴종류  / 키워드 검색 리스트 담기 -->
	<select id="shopSearch7" resultType="com.kat.seat.model.InfoShopSearch">
	select member.company_no, product.menu_name, business.address1, product.menu_category , product.menu_name, product.user_id, product.file_menuphoto, product.menu_loc
	from member inner join business on member.company_no = business.company_no inner join product on business.company_no = product.company_no
	where address1 like CONCAT('%',#{param1},'%') and menu_category like CONCAT('%',#{param2},'%') and menu_name like CONCAT('%',#{param3},'%') limit #{param4}, #{param5}
	</select>
</mapper>


